\chapter{RESULTS}
\thispagestyle{plain}

\label{Results}

In this chapter, I discuss experiments that test \fw for accuracy and computational efficiency.
These experiments also serve as examples of \fw being applied to a variety of ABMs.
In the next section, the different evaluation criteria are outlined.
Each of these metrics will be applied to a number of domains using a number of different techniques for the forward mapping.
The four domains used for the sake of experimentation are outlined in Section \ref{sec:tdomains}: Target Domains.
Each of these domains have unique properties that provide unique challenges to show the versatility of \fw.
The different regression methods for the forward mapping are outlined in Section \ref{sec:fmalgo}: Forward Mapping Methods.
Finally, in Section \ref{sec:exps}: Experiments, the statistical results are discussed.

\section{Evaluation}

Evaluating \fw is important to show that \fw is a practical and useful tool for studying ABMs.
Evaluation is split into two processes: evaluating the forward mapping solution and evaluating the reverse mapping solution.
Accuracy of these mappings in modeling the behavior space of the target ABM is paramount in importance.
If the meta-models are not accurate, there would be no reason to use this framework for investigating behaviors of ABMs.
Computation time is also an important factor in evaluating \fw.
Interactions with the user need to be quick in order to make using \fw more convenient than manually inspecting the target ABM.
The response time of when a user interacts with \fw is the \textit{online} time and is far more important than the \textit{offline} time, the one-time computation requirement to learn the forward or reverse mapping.


 \subsection{Forward Mapping}

  \subsubsection{Accuracy}
Accuracy is the measurement of how closely the forward mapping represents the true behavior space of a target ABM.
To measure this, the difference (error) $\varepsilon$ between the predictions for a system level property $\hat y$ that the forward mapping produces and the actual value $y$ for a sampled point: $\varepsilon = |\hat y - y|$.
This measurement is performed many times for a single domain to produce the average error $\bar \varepsilon$ and the the standard deviation of the errors $\sigma$.

Measuring the error is done by performing cross validation.
Two subsets of data points are randomly pulled from the master set of samples to create a training set and a validation set.
The forward mapping is built by using the training set, and then checked with the validation set.

The error is calculated for varying size data sets to show the relationships between error and data set size.

  \subsubsection{Offline Computation Time}

Offline computation time is the average amount of system time the forward mapping uses to train a model.
This is measured as the amount of time the pre-processing takes, given a training set.
The size of the training set is varied to determine how forward mapping training time is correlated to training set size.
Each forward mapping methods is compared to the others.

  \subsubsection{Online Computation Time}

Online computation time is the average amount of time \fw takes to return the results of a user-submitted query.
This is measured by performing a large number of random queries and calculating the average run time.
The size of the training set can affect the amount of time a query will take with some algorithms.
In these cases, the size of the training set is varied to determine how query time correlates to training set size.

 \subsection{Reverse Mapping}

  \subsubsection{Accuracy vs. Forward Mapping}
Accuracy of the reverse mapping is measured in two ways.
The first is how accurately the reverse mapping models the forward mapping.
Recall that \fw solves the reverse mapping by building an invertible approximation of the forward mapping.
This metric determines if this approach is doing what is expected to do.
The effect that granularity has on this accuracy is also measured by learning the same mapping with increasingly higher granularity.

\begin{figure}[ht]
\centering
\includegraphics[scale=1]{images/mosterror.pdf}
\caption{The most erroneous spot in a right-angled simplex.}
\label{fig:mosterror}
\end{figure}

The error is presented as an ``average worst-case scenario".
The area of the reverse mapping space that is be the most erroneous is typically be the one furthest from the knots (corners of the simplex).
An illustration of this point is presented in Figure \ref{fig:mosterror}.
The point is halfway between all corners, except for the corner at the right angle.
This point is the most erroneous if the forward mapping is monotonically changing from one side of the simplex to the other (i.e., there are no local maxima or minima within the space).
Note that the reverse mapping will be identical to the forward mapping at the knots, since the forward mapping was used to infer their values.

Calculating the approximate upper bound on error, within a simplex, involves interpolating the system-level property value at the most erroneous point.
This is done by average the system-level property values of all corners not at the right angle.
Also, the location of the most erroneous point is queried for prediction through the forward mapping.
The difference between the interpolated value on the simplex and the actual predicted value using the forward mapping constitutes the error.
This metric is applied for every simplex and then averaged.
Thus, the metric measures the average error over all the worst-case scenarios for each simplex.
Also, the standard deviation of these errors is provided to convey how consistent the reverse mapping is.


  \subsubsection{Accuracy vs. Agent-Based Model Run}

The main goal of the reverse mapping is to be able to suggest configurations that would generate this behavior.
This approach is different from the previous metric because it measures the difference between the reverse mapping and the true behavior space.

\begin{figure}[ht]
\centering
\includegraphics[scale=1]{images/closest.pdf}
\caption{Two cases for the closest point to a simplex intersection.}
\label{fig:closest}
\end{figure}

Error is measured by generating a random configuration point and sampling it from the agent-based model.
Then, the system-level property that was measured is passed to \fw to generate a reverse-mapping solution.
The error is the distance from the original configuration and the reverse-mapping solution space.
This value is calculated by adhering to the following procedure, per simplex:
\begin{enumerate}
  \item Determine the distance from the original point to the intersecting hyperplane.
  \item If the shortest line from the hyperplane to the point intersects the hyperplane \textit{within} the simplex, then the distance from the hyperplane is the distance from the intersection to the point.
  \item Otherwise, the closest point is one of the edge intersections.
\end{enumerate}
The two different cases (closest to an edge (left) and closest to the hyperplane (right)) are illustrated in Figure \ref{fig:closest}.
Then, the minimum from all these closest points is taken as the distance from the actual system-level property value and the value provided by the reverse mapping.
This distance is the error.

Several random configurations are sampled in this way.
The average and standard deviation of these errors are calculated to convey the accuracy of the reverse mapping, as well as the consistency of the reverse mapping.

  \subsubsection{Offline and Online Computation Time}
Offline computation time and online computation time is measured the same way for the reverse mapping as the forward mapping.
The amount of time \fw takes to prepare the reverse mapping is the offline computation time, and the amount of time required to produce a reverse mapping solution is the online computation time.





\section{Target Domains}\label{sec:tdomains}

Four target domains are used to show \fw effectiveness in a variety of different types of situations.
No modifications to \fw have to be performed to have \fw compatible with these domains.
This shows that \fw is domain independent.

 \subsection{NetLogo Fires}\label{sec:Fires}



\begin{figure}[ht]
\centering
\includegraphics[scale=1]{images/fires_ui.pdf}
\caption{Screen capture of the Fires NetLogo ABM.}
\label{fig:firesui}
\end{figure}

The NetLogo Fires ABM is the simplest ABM tested in this dissertation.
In this ABM, trees are distributed throughout a $250 \times 250$ grid world.
A fire is started in the left column, in which all trees in this column burn.
Each burning tree then burns its adjacent trees (up, down, left, and right).
This process continues until no more trees are adjacent to burning trees.

The configuration space is one-dimensional and the system-level property space is one dimensional.
The configuration parameter for this domain is the density $\rho$ of the forest, which in our experiments I range from 45 \% to 75\%.
What this parameter does is change the probability that a grid point contains a tree.
During the initialization step, each grid point has a tree placed with probability $\rho$.
The system-level property is the percentage of trees burned down, which is measured by diving the number of trees that were burned by the total number of trees in the system.


The Fires ABM is particularly interesting because it exhibits a threshold effect.
There is a sharp transition from small amounts of the forest burning down and the entire forest burning down when the forest density increases past 58\%.
The behavior space is not linear and exhibits high variance around 58\%, making this ABM moderately challenging, regardless of it only having one configuration parameter.

The Fires ABM is used as an example in this chapter on how to apply every aspect of \fw to a single domain later on in this chapter.


 \subsection{NetLogo Wolf Sheep Predation}
The NetLogo Wolf Sheep Predation ABM has been the running example throughout this dissertation.
In this ABM, there are three major entities: wolves, sheep and grass.
Wolves eat sheep, sheep eat wolves and sheep eat grass.
The grass naturally regrows, meanwhile wolves and sheep occasionally reproduce.
Every time step sheep and wolves lose some energy and die naturally if their energy reaches zero.
A screen capture of the Wolf Sheep Predation ABM in NetLogo is shown in Figure \ref{fig:wolfsheepss}.
The configuration controls are in the top left, the monitors are in the bottom left and the visualization of the domain is on the right.

\begin{figure}[ht]
\centering
\includegraphics[scale=.4]{images/wolfsheep_ss.png}
\caption{Screen capture of the Wolf Sheep Predation ABM.}
\label{fig:wolfsheepss}
\end{figure}

The populations of a running Wolf Sheep Predation system are constantly changing.
Therefore, measuring properties is not as straightforward as in the Fires ABM.
Changes in populations can range from small oscillations to high magnitude oscillations in numbers, depending on the configuration parameters.
Quantitatively capturing these properties is challenging, but is possible with \fw.
A plot of a relatively normal (not too stable and not too high-magnitude) population is shown in Figure \ref{fig:wsp_norm}.

\begin{figure}[ht]
\centering
\includegraphics[scale=.666667]{images/wolfsheep/wolfsheep_normal.png}
\caption{Plot of a stable populations in a Wolf Sheep Predation system.}
\label{fig:wsp_norm}
\end{figure}


\begin{figure}[ht]
\centering
\includegraphics[scale=.666667]{images/wolfsheep/sheepfood_low.png}
\includegraphics[scale=.666667]{images/wolfsheep/sheepfood_high.png}
\caption{Plot of a Wolf Sheep Predation run with low (left) and high (right) \textit{sheep-gain-form-food}.}
\label{fig:wsp_sheepfood}
\end{figure}


\begin{figure}[ht]
\centering
\includegraphics[scale=.666667]{images/wolfsheep/wolffood_low.png}
\includegraphics[scale=.666667]{images/wolfsheep/wolffood_high.png}
\caption{Plot of a Wolf Sheep Predation run with low (left) and high (right) \textit{wolf-gain-form-food}.}
\label{fig:wsp_wolffood}
\end{figure}


\begin{figure}[ht]
\centering
\includegraphics[scale=.666667]{images/wolfsheep/sheepsex_low.png}
\includegraphics[scale=.666667]{images/wolfsheep/sheepsex_high.png}
\caption{Plot of a Wolf Sheep Predation run with low (left) and high (right) \textit{sheep-reproduce}.}
\label{fig:wsp_sheepsex}
\end{figure}


\begin{figure}[ht]
\centering
\includegraphics[scale=.666667]{images/wolfsheep/wolfsex_low.png}
\includegraphics[scale=.666667]{images/wolfsheep/wolfsex_high.png}
\caption{Plot of a Wolf Sheep Predation run with low (left) and high (right) \textit{wolf-reproduce}.}
\label{fig:wsp_wolfsex}
\end{figure}


The configuration space is five-dimensional, making this domain nontrivial to analyze.
The configuration parameters, along with some general observations, are as follows:
\begin{itemize}
   \item \textit{sheep-gain-from-food} -- the amount of energy sheep gain from eating grass.
This parameter has interesting effects on the system.
The effect of changing this parameter from the stable norm is shown in Figure \ref{fig:wsp_sheepfood}.

At lower values, the population of the sheep has difficulty not going extinct.
This almost always results in the wolf population going extinct.

At higher values, sheep live longer and quickly become overpopulated, which causes the grass to become a scarce resource.
With little grass left, the sheep begin to die off.
Once enough sheep have died off, the grass begins to regrow and the sheep begin to reproduce.
This results in sharp increases and decreases in sheep population as the sheep population oscillates between overpopulated and underpopulated.
When the oscillations are of high enough magnitude, the wolves have a high chance of becoming extinct while the sheep population is very low.


   \item \textit{wolf-gain-from-food} -- the amount of energy wolves gain from eating a sheep.
This parameter affects the system in a similar way as \textit{sheep-gain-from-food}.
Lower values cause the wolves to go extinct, while higher values cause more drastic oscillations in wolf and sheep populations.
The effect of changing this parameter from the stable norm is  shown in Figure \ref{fig:wsp_wolffood}.

   \item \textit{sheep-reproduce} -- the percent chance that a sheep will reproduce, per time step.
This parameter has the interesting property that when it is increased, the wolf population increases, but the sheep population remains relatively constant.
When \textit{sheep-reproduce} is too low, the sheep population has difficulties sustaining its numbers, which causes the wolf population to be very low.
The effect of changing this parameter from the stable norm is  shown in Figure \ref{fig:wsp_sheepsex}.

   \item \textit{wolf-reproduce} -- the percent chance that a wolf will reproduce, per time step.
This parameter has relatively little effect on the system, in comparison to the other parameters.
The populations oscillate more when the reproduction rate is higher and more stable with it lower.
The effect of changing this parameter from the stable norm is  shown in Figure \ref{fig:wsp_wolfsex}.

   \item \textit{grass-regrowth-time} -- the amount of time steps a patch of grass takes to regrow.
This is perhaps the strangest behaving configuration parameter.
At higher values, not enough grass grows to sustain a large sheep population, which causes the wolves to go extinct.
At lower values, sheep rarely every die, until they become overpopulated and eat all the grass.
At this point, there is a mass extinction, which causes the wolves to typically go extinct.
In behavior, this parameter is similar to that of \textit{sheep-gain-from-food}.

\end{itemize}
Each of these parameters individually affect the system state.
Even more diverse behaviors can be observed by adjusting several parameters at once.

Several system-level properties have been developed for this domain.
To sample many of these properties and to provide more consistent results, each random configuration is sampled a number of times and averaged.
\begin{itemize}
\item \textit{sheep-extinct?} -- the probability that the sheep population will reach zero.
Every training instance has a value of one or zero for this property.

\end{itemize}

slp: sheep extinct?, wolf extinct?, average wolf population, average sheep population, variance of sheep population, variance of wolf population

 \subsection{NetLogo Traffic Basic}

config: number-of-cars, acceleration, deceleration

slp: average max speed, average min speed, frequency of traffic jam

 \subsection{Reynolds Boids}

config: num-boids, avoidance, center

slp: density, speed


\section{Forward Mapping Methods}\label{sec:fmalgo}

\begin{itemize}
 \item k-Nearest Neighbor (KNN)
 \item Robust Locally Weighted Regression and Smoothing Scatterplots (LOESS)
 \item ?
\end{itemize}



\section{Experiments}\label{sec:exps}

 \subsection{Forward Mapping}

  \subsubsection{Accuracy}

  \subsubsection{Offline Computation Time}

  \subsubsection{Online Computation Time}

 \subsection{Reverse Mapping}

  \subsubsection{Accuracy vs. Forward Mapping}

  \subsubsection{Accuracy vs. System Run}

  \subsubsection{Offline Computation Time}

  \subsubsection{Online Computation Time}
